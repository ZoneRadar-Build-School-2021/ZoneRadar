@model UserInfoViewModel
@{
    ViewBag.Title = Model.User.Name + " - BuyerCard";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var user = Model.User;
    var review = Model.ToUserReview;
    //https://localhost:44322/MemberCenter/UserInfo?memberId=19
}

@if (user.Id > 0 && review.Count() >= 0)
{
    <div class="member member_container container mt-5 pb-3">
        <div class="member_card row">
            <div class="member_card_pic text-center col-sm-12 col-md-4 col-lg-3">
                <img class="mt-4" src="@user.Photo" />
            </div>

            <!--會員卡 + 介紹-->
            <div class="member_card_introduce col-sm-12 col-md-8 col-lg-9">
                <div class="member_card mt-4 row">
                    <div class="member_card_introduce_name col-12">
                        <h3>
                            @user.Name
                            <a href="mailto:@user.Email">
                                <i class="ms-3 fas fa-comment-dots" data-bs-toggle="tooltip" data-bs-placement="right" title="聯絡我">
                                </i>
                            </a>
                        </h3>
                        <p class="mt-4">
                            加入時間：
                            <span class="ms-3">@user.SignUpDateTime.ToString("yyyy-MM-dd")</span>
                        </p>
                    </div>
                </div>
                <div class="member_card row mt-auto">
                    <div class="col-sm-4 col-md-4">
                        <div class="member_verifcation">
                            <p class="member_verifcation_item text-center">認證</p>
                            <p class="member_verifcation_item">
                                <i class="me-3 fas fa-check"></i>Email
                            </p>
                            <p class="member_verifcation_item">
                                @if (user.Phone != null)
                                {
                                    <i class="me-3 fas fa-check"></i>
                                }
                                else
                                {
                                    <i class="me-3 fas fa-times"></i>
                                }Phone
                            </p>
                            <p class="member_verifcation_item">
                                <i class="me-3 fas fa-check"></i>評價
                                <span class="member_verifcation_reviews">
                                    @if (review.Select(x => x.ReviewContent) == null)
                                    {
                                        <span>(0)</span>
                                    }
                                    else
                                    {
                                        <span>(@review.Select(x => x.ReviewContent).Count())</span>
                                    }
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="col-sm-8 col-md-8">
                        <div class="member_verifcation_message">
                            <p>關於我：</p>
                            <span class="member_verifcation_aboutme mt-2">
                                @user.Description
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="member_container container mt-5 p-2">
        <div class="member_choose row p-2">
            <div class="col-6 text-center">
                <h4 class="pb-2">
                    <a href="~/MemberCenter/Member/@user.Id" class="myplace_title active p-1">
                        <i class="me-2 fas fa-pencil-alt"></i>來自賣家的評價
                    </a>
                </h4>
            </div>
            <div class="col-6 text-center">
                <h4 class="pb-2">
                    <a href="~/MemberCenter/Collection/@user.Id" class="myplace_title p-1">
                        <i class="me-2 fas fa-heart"></i>我的收藏
                    </a>
                </h4>
            </div>
        </div>

        <div class="reviewsfromhost row justify-content-center p-3 mt-2">
            <div class="reviewsfromhost_avgstar col-12">
                <p>
                    平均評價：
                    @if (review.Select(x => x.Score).Sum() > 0)
                    {
                        for (var i = 0; i < (review.Select(x => x.Score).Average()); i++)
                        {
                            <i class="fas fa-star"></i>
                        }
                    }
                    else
                    {

                    }
                    <i class="ms-2 me-1 fas fs-5 fa-check"></i>
                    <span class="me-1">
                        @review.Where(x => x.Recommend == true).Count()
                    </span>
                    |
                    <i class="ms-2 me-1 fs-5 fas fa-times"></i>
                    <span>
                        @review.Where(x => x.Recommend == false).Count()
                    </span>
                </p>
            </div>
            <div class="reviewsfromhost_review col-12">
                @if (review.Count() > 0)
                {
                    foreach (var r in review)
                    {
                        <div class="reviewsfromhost_review_card row mt-4">
                            <div class="reviewsfromhost_review_card_pic mb-3 col-sm-2 col-md-2 col-lg-2">
                                <a href="~/MemberCenter/Host/@r.Id">
                                    <img src="@r.SpaceMemberPhoto" />
                                </a>
                            </div>
                            <div class="reviewsfromhost_review_card_txt mb-4 col-sm-10 col-md-10 col-lg-10">
                                <div class="reviewsfromhost_review_card_txt_name">
                                    <a href="~/MemberCenter/Host/@r.Id">@r.Name</a>
                                </div>
                                <div class="reviewsfromhost_review_card_txt_star mt-2">
                                    @if (r.Score == 0)
                                    {
                                        <span>目前沒有任何評價</span>
                                    }
                                    else if (r.Score % 1 == 0)
                                    {
                                        for (int i = 0; i < r.Score; i++)
                                        {
                                            <i class="fas fa-star"></i>
                                        }
                                    }
                                    else
                                    {
                                        for (int i = 0; i < (r.Score - 1); i++)
                                        {
                                            <i class="fas fa-star"></i>
                                        }
                                        <i class="fas fa-star-half-alt"></i>
                                    }
                                </div>
                                @if (r.Recommend == true)
                                {
                                    <div class="reviewsfromhost_review_card_txt_check mt-2">
                                        <i class="me-1 fas fa-check"></i>我還會想再次接待他們
                                    </div>
                                }
                                else
                                {
                                    <div class="reviewsfromhost_review_card_txt_check mt-2">
                                        <i class="me-1 fas fa-times"></i>我不會想再次接待他們
                                    </div>
                                }
                                <p class="mt-3">
                                    "
                                    <span class="reviewsfromhost_review_card_txt_msg">
                                        @r.ReviewContent
                                    </span>
                                    "
                                </p>
                                <p class="reviewsfromhost_review_card_txt_date">
                                    <span>@r.ReviewDate.ToString("yyyy-MM-dd")</span>
                                </p>
                                <a href="~/Booking/BookingPage/@r.SpaceId">
                                    <span class="reviewsfromhost_review_card_txt_place">@r.SpaceName</span>
                                </a>
                                <div class="reviewsfromhost_review_card_txt_location">
                                    <div class="reviewsfromhost_review_card_txt_location_a">
                                        <a href="~/Searching/SearchingPage/@r.City">
                                            <span>@r.City</span>
                                        </a>
                                        <a href="~/Searching/SearchingPage/@r.District">
                                            <span>@r.District</span>
                                        </a>
                                        <a href="~/Searching/SearchingPage/@r.Address">
                                            <span>@r.Address</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8 offset-lg-2 col-sm-12">
                                <img src="~/Assets/IMG/NoReview(user).png" />
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
}
else
{
    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2 col-sm-12">
                <img src="~/Assets/IMG/NoReview(user).png" />
            </div>
        </div>
    </div>
}
@section topCSS{
    <link href="~/Assets/CSS/member_card/memberstyle_buyer_evaluation.css" rel="stylesheet" />
}
